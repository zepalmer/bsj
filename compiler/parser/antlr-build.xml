<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     Aug 20, 2009 1:56:07 PM                                                        

     BSJ ANTLR Parser    
     The ANTLR parser used by the BSJ compiler
                   
     Zachary Palmer                                                                
     ====================================================================== -->
<project name="BSJ ANTLR Parser" default="antlr">
    <description>
            The ANTLR parser used by the BSJ compiler.
    </description>
	
	<!-- Names the ANTLR grammar file. -->
	<property name="grammar" value="src/edu/jhu/cs/bsj/compiler/grammar/BsjAntlr.g"/>
	<!-- Names the directory which should contain the sources on which the parser depends. -->
	<property name="presrc" value="src-pre" />
	<!-- Names the directory which will contain the generated sources. -->
	<property name="gensrc" value=".gen/src" />
	<!-- Names the directory which will contain the compiled ANTLR parser. -->
	<property name="genbin" value=".gen/bin" />
	<!-- Names the directory containing the parser's package. -->
	<property name="parserPackage" value="${gensrc}/edu/jhu/cs/bsj/compiler/tool/parser/antlr" />
    <!-- Names the directory containing compiled binaries for the BSJ Compiler API. -->
    <property name="compilerApiPath" value="../api/bin" />
    <!-- Names the directory containing compiled binaries for the BSJ Utilities project. -->
    <property name="utilsPath" value="../utils/bin" />
	<!-- Indicates the classpath for a build of the parser. -->
	<path id="parser.classpath">
        <fileset dir="lib">
            <include name="*.jar"/>
        </fileset>
		<pathelement path="${genbin}"/>
		<pathelement path="${compilerApiPath}"/>
		<pathelement path="${utilsPath}"/>
	</path>
	
    <!-- - - - - - - - - - - - - - - - - - 
          target: prebuild                      
         - - - - - - - - - - - - - - - - - -->
	<target name="prebuild" description="Builds the sources on which the ANTLR parser depends">
		<mkdir dir="${genbin}"/>
		<javac
		        destdir="${genbin}"
		        srcdir="${presrc}"
                debug="true">
			<classpath refid="parser.classpath"/>
		</javac>
	</target>

    <!-- - - - - - - - - - - - - - - - - - 
          target: antlr                      
         - - - - - - - - - - - - - - - - - -->
    <target name="antlr" depends="prebuild" description="Uses ANTLR to generate the parser's source files">
    	<mkdir dir="${parserPackage}"/>
    	<antlr:antlr3 xmlns:antlr="antlib:org/apache/tools/ant/antlr"
    	    target="${grammar}"
    		outputdirectory="${parserPackage}"
    		conversiontimeout="100000">
    		<jvmarg value="-Xmx1024m"/>
    	</antlr:antlr3>
    	<mkdir dir="${genbin}"/>
    	<javac
    		    destdir="${genbin}"
    		    srcdir="${gensrc}"
    		    debug="true">
    		<classpath refid="parser.classpath"/>
        </javac>
    	
    </target>

    <!-- - - - - - - - - - - - - - - - - - 
          target: clean                      
         - - - - - - - - - - - - - - - - - -->
    <target name="clean" description="Cleans the project">
    	<delete dir="${gensrc}"/>
    	<mkdir dir="${gensrc}"/>
    	<delete dir="${genbin}"/>
    	<mkdir dir="${genbin}"/>
    </target>
</project>
